<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments::head}"></head>
<link rel="stylesheet" th:href="@{/css/post.css}">

<body>

<div class="container">
    <header th:replace="~{fragments::header}"></header>

    <section>
        <h2>Posts</h2>
        <hr>
        <div id="posts" th:each="post : ${posts}" th:attr="data-post_id=${post.id}">
            <h2 th:text="${post.title}"></h2>
            <div id="summary" th:attr="data-post_content=${post.content}"></div>
        </div>
    </section>


    <footer th:replace="~{fragments::footer}"></footer>
</div>

</body>
<script>

    function afterDOMLoad() {
        document.querySelectorAll('div#summary').forEach(
            element => {
                element.innerHTML = marked.parse(element.dataset.post_content);
            }
        )

        document.querySelectorAll('div#posts').forEach(
            post => {
                post.addEventListener('click', () => window.location.href='/post/'+post.dataset.post_id);
            }
        )
    }

    document.addEventListener('DOMContentLoaded', afterDOMLoad());
</script>
</html>